"""ÐšÐ¾Ñ€Ð¾Ð±ÐºÐ° Ñ Ð¸Ð³Ñ€ÑƒÑˆÐºÐ°Ð¼Ð¸.

Ð Ð°ÑÑˆÐ¸Ñ€ÐµÐ½Ð¸Ðµ, ÐºÐ¾Ñ‚Ð¾Ñ€Ð¾Ðµ Ð¿Ñ€ÐµÐ´Ð¾ÑÑ‚Ð°Ð²Ð»ÑÐµÑ‚ Ñ€Ð°Ð·Ð»Ð¸Ñ‡Ð½Ñ‹Ðµ Ð·Ð°Ð±Ð°Ð²Ð½Ñ‹Ðµ ÐºÐ¾Ð¼Ð°Ð½Ð´Ñ‹ Ð±ÐµÐ·
ÐºÐ°ÐºÐ¾Ð¹-Ð»Ð¸Ð±Ð¾ Ð¾Ð¿Ñ€ÐµÐ´ÐµÐ»Ñ‘Ð½Ð½Ð¾Ð¹ Ñ‚ÐµÐ¼Ð°Ñ‚Ð¸ÐºÐ¸.

ÐŸÑ€ÐµÐ´Ð¾ÑÑ‚Ð°Ð²Ð»ÑÐµÑ‚
-------------

- /ping: ÐŸÑ€Ð¾Ð²ÐµÑ€Ð¸Ñ‚ÑŒ Ñ‡Ñ‚Ð¾ Ð±Ð¾Ñ‚ Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÐµÑ‚.

Version: v0.2 (2)
Author: Milinuri Nirvalen
"""

import random

import arc
import hikari

plugin = arc.GatewayPlugin("funbox")


# Ð¾Ð¿Ñ€ÐµÐ´ÐµÐ»ÐµÐ½Ð¸Ðµ ÐºÐ¾Ð¼Ð°Ð½Ð´
# ==================


@plugin.include
@arc.slash_command("ping", description="ÐŸÑ€Ð¾Ð²ÐµÑ€Ð¸Ñ‚ÑŒ Ñ‡Ñ‚Ð¾ Ð±Ð¾Ñ‚ Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÐµÑ‚")
async def ping(ctx: arc.GatewayContext):
    """ÐŸÑ€Ð¾Ð²ÐµÑ€Ð¸Ñ‚ÑŒ Ñ‡Ñ‚Ð¾ Ð±Ð¾Ñ‚ Ð² ÑÐµÑ‚Ð¸."""
    await ctx.respond("ÐŸÐ¾Ð½Ð³!")


# ÐŸÑ€Ð¾ÑÑ‚ÐµÐ½ÑŒÐºÐ¸Ðµ Ð¸Ð³Ñ€Ñ‹ -------------------------------------------------------------


@plugin.include
@arc.slash_command("dice", description="ÐŸÐ¾Ð´Ð±Ñ€Ð¾ÑÐ¸Ñ‚ÑŒ ÐºÑƒÐ±Ð¸Ðº")
async def dice(
    ctx: arc.GatewayContext,
    sides: arc.Option[int, arc.IntParams("Ð¡ÐºÐ¾Ð»ÑŒÐºÐ¾ ÑÑ‚Ð¾Ñ€Ð¾Ð½ Ñƒ ÐºÑƒÐ±Ð¸ÐºÐ° (6)")] = 6,
    count: arc.Option[int, arc.IntParams("Ð¡ÐºÐ¾Ð»ÑŒÐºÐ¾ Ð±ÑƒÐ´ÐµÑ‚ ÐºÑƒÐ±Ð¸ÐºÐ¾Ð² (1)")] = 1,
):
    """ÐŸÐ¾Ð´Ð±Ñ€Ð°ÑÑ‹Ð²Ð°ÐµÑ‚ ÐºÑƒÐ±Ð¸Ðº.

    ÐŸÐ¾ ÑƒÐ¼Ð¾Ð»Ñ‡Ð°Ð½Ð¸ÑŽ Ð¿Ð¾Ð´Ð±Ñ€Ð°ÑÑ‹Ð²Ð°ÐµÑ‚ 1 ÐºÑƒÐ±Ð¸Ðº Ñ 6-Ñ‚ÑŒÑŽ Ð³Ñ€Ð°Ð½ÑÐ¼Ð¸.
    Ð’Ñ‹ Ð¼Ð¾Ð¶ÐµÑ‚Ðµ Ð¿ÐµÑ€ÐµÐ¾Ð¿Ñ€ÐµÐ´ÐµÐ»Ð¸Ñ‚ÑŒ, ÑÐºÐ¾Ð»ÑŒÐºÐ¾ Ð±ÑƒÐ´ÐµÑ‚ ÐºÑƒÐ±Ð¸ÐºÐ¾Ð² Ð¸ ÑÐºÐ¾Ð»ÑŒÐºÐ¾ Ð±ÑƒÐ´ÐµÑ‚
    Ñƒ Ð½Ð¸Ñ… Ð³Ñ€Ð°Ð½ÐµÐ¹.
    Ð¡Ð¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ Ñ Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚Ð¾Ð¼ ÑÐ¾Ð´ÐµÑ€Ð¶Ð¸Ñ‚ Ð½Ð°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ¸ ÐºÑƒÐ±Ð¸ÐºÐ¾Ð², Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚Ñ‹ Ð´Ð»Ñ
    Ð¿Ð¾Ð´Ð±Ñ€Ð¾ÑÐ° ÐºÐ°Ð¶Ð´Ð¾Ð³Ð¾ ÐºÑƒÐ±Ð¸ÐºÐ° Ð¸ ÐºÐ¾Ð½ÐµÑ‡Ð½ÑƒÑŽ ÑÑƒÐ¼Ð¼Ñƒ.
    """
    # Ð’Ð°Ð»Ð¸Ð´Ð°Ñ†Ð¸Ñ Ð²Ñ…Ð¾Ð´ÑÑ‰Ð¸Ñ… Ð¿Ð°Ñ€Ð°Ð¼ÐµÑ‚Ñ€Ð¾Ð²
    sides = min(max(3, sides), 100)
    count = min(max(1, count), 10)
    if count > 1:
        result = [random.randint(1, sides) for _ in range(count)]
    else:
        result = random.randint(1, sides)

    # Ð¡Ð¾Ð±Ð¸Ñ€Ð°ÐµÐ¼ ÐºÑ€Ð°ÑÐ¸Ð²Ð¾Ðµ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ
    emb = hikari.Embed(
        title="ðŸŽ² ÐŸÐ¾Ð´Ð±Ñ€Ð¾ÑÐ¸Ð»Ð¸ ÐºÑƒÐ±Ð¸ÐºÐ¸",
        description=(
            "Ð’Ñ‹ Ð±ÐµÑ€Ñ‘Ñ‚Ðµ ÑÐ²Ð¾Ð¸ Ð»ÑŽÐ±Ð¸Ð¼Ñ‹Ðµ ÐºÑƒÐ±Ð¸ÐºÐ¸.\n"
            "ÐÐµÐ¼Ð½Ð¾Ð³Ð¾ Ð¿Ð¾Ñ‚Ñ€ÐµÑÑ Ð¸Ñ… Ð² Ð»Ð°Ð´Ð¾Ð½ÑÑ…, Ð²Ñ‹, Ð»Ñ‘Ð³ÐºÐ¸Ð¼ Ð´Ð²Ð¸Ð¶ÐµÐ½Ð¸ÐµÐ¼ Ñ€ÑƒÐºÐ¸,"
            "Ð²Ñ‹Ð±Ñ€Ð°ÑÑ‹Ð²Ð°ÐµÑ‚Ðµ Ð¸Ñ… Ð½Ð° ÑÑ‚Ð¾Ð».\n\n"
            "Ð§Ñ‚Ð¾Ð¶Ðµ Ñ‚ÑƒÑ‚ Ñƒ Ð½Ð°Ñ?"
        ),
        color=hikari.colors.Color(0xF66151),
    )

    # Ð”Ð¾Ð°Ð±Ð²Ð»ÑÐµÐ¼ Ñ€ÑƒÐ·Ð°Ð»ÑŒÑ‚Ð°Ñ‚ Ð¿Ð¾Ð´ÑÑ‡Ñ‘Ñ‚Ð¾Ð²
    if count == 1:
        emb.add_field(name="Ð˜Ñ‚Ð¾Ð³Ð¾", value=str(result))
    else:
        str_value = str(result[0])
        for r in result[1:]:
            str_value += f" + {r}"
        str_value += f" = {sum(result)}"
        emb.add_field(name="Ð˜Ñ‚Ð¾Ð³Ð¾", value=str_value)

    return await ctx.respond(embed=emb)


_FLIP_RESULTS = ["ÐžÑ€Ð»Ð°", "Ð ÐµÑˆÐºÑƒ"]


@plugin.include
@arc.slash_command("flip", description="ÐŸÐ¾Ð´Ð±Ñ€Ð¾ÑÐ¸Ñ‚ÑŒ Ð¼Ð¾Ð½ÐµÑ‚ÐºÑƒ")
async def flip_handler(ctx: arc.GatewayContext):
    """ÐŸÐ¾Ð´Ð±Ñ€Ð°ÑÑ‹Ð²Ð°ÐµÑ‚ Ð¼Ð¾Ð½ÐµÑ‚ÐºÑƒ.

    Ð’Ñ‹ Ð¼Ð¾Ð¶ÐµÑ‚Ðµ Ð¿Ð¾Ð´Ð±Ñ€Ð¾ÑÐ¸Ñ‚ÑŒ Ñ‚Ð¾Ð»ÑŒÐºÐ¾ Ð¾Ð´Ð½Ñƒ Ð¼Ð¾Ð½ÐµÑ‚ÐºÑƒ.
    Ð’ Ñ€ÑƒÐ·Ð»ÑŒÑ‚Ð°Ñ‚Ðµ Ð¼Ð¾Ð¶ÐµÑ‚ Ð²Ñ‹Ð¿Ð°ÑÑ‚ Ð¾Ñ€Ñ‘Ð» Ð¸Ð»Ð¸ Ñ€ÐµÑˆÐºÐ°.
    Ð¡Ð¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ Ñ Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚Ð¾Ð¼ ÑÐ¾Ð´ÐµÑ€Ð¶Ð¸Ñ‚ Ð²Ñ‹Ð¿Ð°Ð²ÑˆÑƒÑŽ ÑÑ‚Ð¾Ñ€Ð¾Ð½Ñƒ Ð¼Ð¾Ð½ÐµÑ‚ÐºÐ¸.
    """
    result = random.randint(0, 1)
    result_str = _FLIP_RESULTS[result]
    await ctx.respond(f"ðŸª™ ÐŸÐ¾Ð´Ð±Ñ€Ð¾ÑÐ¸Ð² Ð¼Ð¾Ð½ÐµÑ‚ÐºÑƒ Ð²Ñ‹ ÑƒÐ²Ð¸Ð´ÐµÐ»Ð¸ Ñ‚Ð°Ð¼ {result_str}")


# 8ÑˆÐ°Ñ€ -------------------------------------------------------------------------

_BALL_PREFIX = [
    "ÑÐ¾Ð²ÐµÑ€ÐµÐ½Ð½Ð¾ Ñ‚Ð¾Ñ‡Ð½Ð¾ ",
    "Ð¾Ð¿Ñ€ÐµÐ´ÐµÐ»Ñ‘Ð½Ð½Ð¾ ",
    "ÑÐºÐ¾Ñ€ÐµÐµ Ð²ÑÐµÐ³Ð¾ ",
    "Ð·Ð²ÐµÐ·Ð´Ñ‹ Ð¿Ð¾Ð´Ñ‡ÐºÐ°Ð·Ñ‹Ð²Ð°ÑŽÑ‚ Ñ‡Ñ‚Ð¾ ",
    "Ð²Ð¾Ð·Ð¼Ð¾Ð¶Ð½Ð¾ ",
    "Ð²ÐµÑ€Ð¾ÑÑ‚Ð½Ð¾ ",
]

_BALL_RESULT = ["Ð´Ð°", "Ð½ÐµÑ‚", "Ð¿Ð¾Ð¿Ñ€Ð¾Ð±ÑƒÐ¹Ñ‚Ðµ Ð¿Ð¾Ð·Ð¶Ðµ", "Ð½Ðµ Ð·Ð½Ð°ÑŽ", "Ð½Ðµ ÑƒÐ²ÐµÑ€ÐµÐ½"]


@plugin.include
@arc.slash_command("ball", description="ÐŸÐ¾Ð»ÑƒÑ‡Ð¸Ñ‚ÑŒ ÑÐ¾Ð²ÐµÑ‚ Ð¾Ñ‚ ÑˆÐ°Ñ€Ð°")
async def flip_handler(ctx: arc.GatewayContext):
    """8 ÑˆÐ°Ñ€.

    Ð’Ñ‹ Ð¼Ð¾Ð¶ÐµÑ‚Ðµ Ð·Ð°Ð´Ð°Ñ‚ÑŒ Ð»ÑŽÐ±Ð¾Ð¹ Ð²Ð¾Ð¿Ñ€Ð¾Ñ, Ð° Ð¼ÑƒÐ´Ñ€Ñ‹Ð¹ ÑˆÐ°Ñ€ Ð¿Ð¾Ð´ÑÐºÐ°Ð¶ÐµÑ‚ Ð²Ð°Ð¼ Ð¾Ñ‚Ð²ÐµÑ‚.
    ÐÐ° ÑÐ°Ð¼Ð¾Ð¼ Ð´ÐµÐ»Ðµ Ð¾Ñ‚Ð²ÐµÑ‚ Ð¿Ð¾Ð´Ð±Ð¸Ñ€Ð°ÐµÑ‚ÑÑ ÑÐ»ÑƒÑ‡Ð°Ð¹Ð½Ñ‹Ð¹.
    ÐÐ¾ Ñ‚Ð°Ðº Ð²ÐµÐ´ÑŒ Ð´Ð°Ð¶Ðµ Ð²ÐµÑÐµÐ»ÐµÐµ.
    """
    if random.randint(0, 1) == 1:
        prefix = random.choice(_BALL_PREFIX)
    else:
        prefix = ""
    result = random.choice(_BALL_RESULT)

    await ctx.respond(f"ðŸ”® **ÐœÑƒÐ´Ñ€Ñ‹Ð¹ ÑˆÐ°Ñ€ Ð³Ð¾Ð²Ð¾Ñ€Ð¸Ñ‚ Ð’Ð°Ð¼**:\n\n> {prefix}{result}")


# Ð—Ð°Ð³Ñ€ÑƒÐ·Ñ‡Ð¸ÐºÐ¸ Ð¸ Ð²Ñ‹Ð³Ñ€ÑƒÐ·Ñ‡Ð¸ÐºÐ¸ Ð¿Ð»Ð°Ð³Ð¸Ð½Ð°
# ===============================


@arc.loader
def loader(client: arc.GatewayClient) -> None:
    client.add_plugin(plugin)


@arc.unloader
def unloader(client: arc.GatewayClient) -> None:
    client.remove_plugin(plugin)
